'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _MediaQueryList = require('./MediaQueryList');

var _MediaQueryList2 = _interopRequireDefault(_MediaQueryList);

var _evalQuery = require('./evalQuery');

var _evalQuery2 = _interopRequireDefault(_evalQuery);

var _matchMedia = require('./matchMedia');

var _matchMedia2 = _interopRequireDefault(_matchMedia);

var _listenerTrigger = require('./listenerTrigger');

var _listenerTrigger2 = _interopRequireDefault(_listenerTrigger);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/* eslint no-param-reassign: off */

const matchMediaPolyfill = context => {
  const listeners = new Map();

  const evalQuery = (0, _evalQuery2.default)(context);

  Object.assign(context, {
    MediaQueryList: _MediaQueryList2.default,
    matchMedia: (0, _matchMedia2.default)({
      addListener: (0, _MediaQueryList.addListener)(listeners),
      removeListener: (0, _MediaQueryList.removeListener)(listeners),
      evalQuery
    })
  });

  const trigger = (0, _listenerTrigger2.default)(evalQuery);

  context.addEventListener('resize', () => listeners.forEach(trigger));
};

exports.default = matchMediaPolyfill;