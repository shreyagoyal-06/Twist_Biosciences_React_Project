'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _unitToPixels = require('./unitToPixels');

var _unitToPixels2 = _interopRequireDefault(_unitToPixels);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const unitsReplace = ($0, $1, $2) => String(+$1 * (0, _unitToPixels2.default)($2));

const compileQuery = rawQuery => 'try { return !!(%s) } catch(e) { return false }'.replace('%s', rawQuery.split(/\s*,\s*/g).map(part => part.replace(/^\s*only\s+/, '').replace(/^\s*not\s*(.+)/, '!($1)').replace(/(?:min-)([\w.]+)\s*:\s*/g, 'media.$1 >= ').replace(/(?:max-)([\w.]+)\s*:\s*/g, 'media.$1 <= ').replace(/([\w.]+)\s*:\s*/g, 'media.$1 === ').replace(/\s*all|screen\s*/g, 'true').replace(/\s*print\s*/g, 'false').replace(/[\s()]+or[\s()]+/g, ' || ').replace(/\s*and\s*/g, ' && ').replace(/dpi/g, '').replace(/(\d+)(cm|em|in|dppx|mm|pc|pt|px|rem)/g, unitsReplace).replace(/^(.*)$/, '($1)')).join(' || '));

exports.default = compileQuery;